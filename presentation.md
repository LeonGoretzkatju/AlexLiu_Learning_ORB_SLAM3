# 2021.02.09

## 1.ORB_SLAM3与VINS_MONO的VIO部分比较

|                      | ORB_SLAM3                                                    | VINS                                                         |
| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| IMU的偏差            | 同时考虑了加速度计和陀螺仪的偏差，并且将其放在目标函数中与重力方向，尺度因子等待优化变量共同优化，在inertialoptimization函数 | 只估计了陀螺仪的偏差，并且是将其考虑成非线性的，将其独立出来单独优化，没有采用g2o求解器，而是直接一次高斯牛顿迭代解决，在initial_aligment.cpp中的solveGyroscopeBias中。 |
| 速度，重力，尺度因子 | 与IMU偏差共同估计，通过最大后验估计并取负对数将其转换成包含IMU先验残差的非线性最小二乘问题，利用g2o去求解inertial-only map下的因子图，速度，尺度与重力方向都是顶点 | initial_alignment.cpp中的linearalignment(),首先根据预积分量的约束，将世界坐标系转换成相机在t0时刻的坐标系，转换成线性最小二乘问题ceres求解 |
| IMU的优化内容        | inertialoptimization中默认各个关键帧对应的IMU的pose是一致的，只优化了IMU的速度，在初始化成功后的5秒和15秒又再次初始化。 | 状态估计器中的Estimator::visualInitialAlign()，计算陀螺仪的偏置校准(加速度偏置没有处理)，同时更新了Bgs后，IMU repropagate；得到尺度s和重力g的方向后，转换到第一帧坐标系，然后转换到世界坐标系 |
| 重力g的优化          | 代码中在g与速度等待优化变量的目标函数求解后直接对齐，得出结果，没有看到更多的判断 | 在linearalignment中RefineGravity进一步细化了重力，在其切线空间上用两个变量重新参数化重力，迭代四次，对状态向量重新优化。 |
| 惯性系的对齐         | 在IMU的优化过程中目标函数求解过程同时解算出了优化后的rotation matrix | 计算出重力在第一个关键帧的测量值后对重力进行参数化，限制模长，判断误差是否大于百分之五，然后重力细化，进行坐标系的对齐。 |
| scale的优化          | 在初始化及其之后的100秒之内不断优化尺度和重力方向            | 只在初始化的过程进行优化                                     |
| 求解形式             | SO(3)                                                        | 四元数                                                       |

## ORB_SLAM各个版本的比较与分析

ORB_SLAM:基本流程图与框架如下

![image-20210210202522028](C:\Users\T430\AppData\Roaming\Typora\typora-user-images\image-20210210202522028.png)

追踪线程->局部建图线程->loop closing   位置重识别

所有步骤统一使用图像的ORB特征。ORB特征是一种非常快速的特征提取方法，通过判断一个点附近的亮度变化情况来进行特征点选取，具有旋转不变性，并可以利用金字塔构建出尺度不变性。使用统一的ORB特征有助于SLAM算法在特征提取与追踪、关键帧选取、三维重建、闭环检测等步骤具有内生的一致性。

一、追踪线程

1. ORB特征提取
2. 初始姿态估计（速度估计）
3. 姿态优化（Track local map，利用邻近的地图点寻找更多的特征匹配，优化姿态）
4. 关键帧的决定

二、局部建图线程

1. 加入关键帧（更新各种图）
2. 剔除一些越界离群的地图点
3. 生成新的地图点（三角法）
4. 局部Bundle adjustment（该关键帧和邻近关键帧，去除Outlier）
5. 去除重复的关键帧（判断标准是特征点匹配的相似度）

三、闭环检测

1. 选取相似帧（bag of words）
2. 检测闭环（计算相似变换（3D<->3D，存在尺度漂移，因此是相似变换），RANSAC计算内点数）
3. 融合三维点，优化关键图
4. 图优化（传导变换矩阵），更新地图所有点

特点：1.对ROS有依赖，通过topic来读取相机的图片，显示模块用的RVIZ 港科大的VINS也是用了RVIZ，个人感觉还是pangolin轻量化更直观一些

​			2.ORB_SLAM将特征点都一次性放在了vector里面，感觉很有可能会特征点堆集。

​			3.对于初始化的要求很高，最好初始化时候找一个特征比较多的地方，而且要慢速移动，坐标系建立在第一个初始化成功的图像的位置，所以不能停下来。

ORB_SLAM2:

![image-20210210211543886](C:\Users\T430\AppData\Roaming\Typora\typora-user-images\image-20210210211543886.png)

1.提供了单目双目的接口 同时与ROS解耦合，配置更加简单，增加了输入数据预处理部分

2.对特征匹配部分的代码进行了部分重写

3.采用四叉树来存储特征点，加速了匹配过程以及均匀化分布特征点，防止过于集中

ORB_SLAM3:

![image-20210205163837752](C:\Users\T430\AppData\Roaming\Typora\typora-user-images\image-20210205163837752.png)

1.ORB_SLAM3是第一个基于特征的紧耦合的VIO系统，仅依赖于最大后验估计(包括IMU在初始化时)代码部分对应于MLPNP部分，在IMU的初始化部分引入了map。

2.系统根据改进召回的新的重定位模块来构建的混合地图，因为这个模块可以让ORB-SLAM3在特征点较少的场景中长期运行：当里程计失败的时候，系统会重新构建地图并将这个地图和原来构建的地图对齐。如果是原有的DBOW2的话需要匹配三个连续的关键帧，而ORB_SLAM3对候选的关键帧第一次就进行几何一致性检测，然后利用三个共视的关键帧进行局部的一致性检验，这种策略提升了召回率，并增强了数据关联，提高了地图准确性，但是这是以显著提高计算成本作为代价的，所以导致ORB_SLAM3在内存不足的情况下无法运行。

3.ORB_SLAM3是可以解决纯视觉或者视觉惯导的完整的混合地图的SLAM系统，Atlas代表的是地图的集合，可以把其中的地图应用到所有的建图过程中，如场景重识别、相机重定位、闭环检测和精确的地图融合，即该系统为增量的SLAM系统，而ORB_SLAM3添加了visual-inertial的混合地图系统来实现场景重识别。

4.不限制相机模型，只需提供投影，反投影及Jacobian方程（程序中提供了针孔与鱼眼模型）

# 2020.02.10 与学长交流后的任务安排

1.重点关注ORB_SLAM3中的Atlas地图集部分，想明白它是如何进行多地图融合的，融合的根据是什么，如果我们在点特征提取之外加入线和面的特征，如何将曼哈顿假设引入地图融合合并复用，建立包含曼哈顿假设的地图集
2.重点研究IMU部分，在初始化以及后续线程中IMU的加速度计以及陀螺仪的偏差、速度、重力方向、尺度因子是如何计算出来的，依据是什么，搞明白详细的公式以及代码中是如何实现的，怎么样将点线面的特征加入到IMU参数初始化和优化的过程中，怎么根据几何约束特征来优化IMU的参数以及重力的求解。